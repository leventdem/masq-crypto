!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MasqCrypto=e()}}(function(){return function e(t,n,r){function i(a,u){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AES=n.aesModes=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./utils.js")),o=function(e){console.log(e)},a=["aes-cbc","aes-gcm","aes-ctr"],u=[128,192,256],c=function(e,t,n){return crypto.subtle.decrypt(n,t,e).then(function(e){return new Uint8Array(e)}).catch(o)},s=function(e,t,n){return crypto.subtle.encrypt(n,t,e).then(function(e){return new Uint8Array(e)}).catch(o)},l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mode=t.mode||"aes-gcm",this.keySize=t.keySize||128,this.IV=t.iv||null,this.key=t.key||null,this.length=t.length||128,this.additionalData=t.additionalData||""}return r(e,[{key:"checkRaw",value:function(e,t){return new Promise(function(n,r){t instanceof Uint8Array?e.importKeyRaw(t).then(n).catch(function(e){return console.log(e)}):n(t)})}},{key:"importKeyRaw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"raw";return crypto.subtle.importKey(t,e,{name:this.mode},!0,["encrypt","decrypt"])}},{key:"exportKeyRaw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"raw";return crypto.subtle.exportKey(t,e)}},{key:"decrypt",value:function(e){var t={},n={};return t.ciphertext=e.hasOwnProperty("ciphertext")?i.hexStringToBuffer(e.ciphertext):"","aes-gcm"===this.mode?(t.iv=e.hasOwnProperty("iv")?i.hexStringToBuffer(e.iv):"",t.additionalData=e.hasOwnProperty("version")?i.toArray(e.version):[],n.name=this.mode,n.iv=t.iv,n.additionalData=t.additionalData,this.checkRaw(this,this.key).then(function(e){return c(t.ciphertext,e,n)}).then(function(e){return i.toString(e)}).catch(o)):"aes-cbc"===this.mode?(t.iv=e.hasOwnProperty("iv")?i.hexStringToBuffer(e.iv):"",n.name=this.mode,n.iv=t.iv,this.checkRaw(this,this.key).then(function(e){return c(t.ciphertext,e,n)}).then(function(e){return i.toString(e)}).catch(o)):"aes-ctr"===this.mode?(t.iv=e.hasOwnProperty("iv")?i.hexStringToBuffer(e.iv):"",n.name=this.mode,n.counter=t.iv,n.length=this.length,this.checkRaw(this,this.key).then(function(e){return c(t.ciphertext,e,n)}).then(function(e){return i.toString(e)}).catch(o)):void console.log("The mode "+this.mode+" is not yet supported")}},{key:"encrypt",value:function(e){var t={},n={};return t.plaintext=i.toArray(e),"aes-gcm"===this.mode?(t.iv=this.iv||window.crypto.getRandomValues(new Uint8Array(12)),t.additionalData=i.toArray(this.additionalData),n.name=this.mode,n.iv=t.iv,n.additionalData=t.additionalData,this.checkRaw(this,this.key).then(function(e){return s(t.plaintext,e,n)}).then(function(e){return{ciphertext:i.bufferToHexString(e),iv:i.bufferToHexString(t.iv),version:i.toString(t.additionalData)}}).catch(o)):"aes-cbc"===this.mode?(t.iv=this.iv||window.crypto.getRandomValues(new Uint8Array(16)),n.name=this.mode,n.iv=t.iv,this.checkRaw(this,this.key).then(function(e){return s(t.plaintext,e,n)}).then(function(e){return{ciphertext:i.bufferToHexString(e),iv:i.bufferToHexString(t.iv)}}).catch(o)):"aes-ctr"===this.mode?(t.iv=this.iv||window.crypto.getRandomValues(new Uint8Array(16)),n.name=this.mode,n.counter=t.iv,n.length=this.length,this.checkRaw(this,this.key).then(function(e){return s(t.plaintext,e,n)}).then(function(e){return{ciphertext:i.bufferToHexString(e),iv:i.bufferToHexString(t.iv)}}).catch(o)):void console.log("The mode "+this.mode+" is not yet supported")}},{key:"genAESKey",value:function(){return crypto.subtle.generateKey({name:this.mode||"aes-gcm",length:this.keySize||128},!0,["decrypt","encrypt"])}},{key:"additionalData",get:function(){return this._additionalData},set:function(e){"string"==typeof e?this._additionalData=e:(console.log("You did not provide a string for additional data, default value is ''."),this._additionalData="")}},{key:"key",get:function(){return this._key},set:function(e){this._key=e}},{key:"mode",get:function(){return this._mode},set:function(e){a.includes(e)?this._mode=e:(console.log(e+" is not accepted."),console.log("Accepted modes are "+a.join(", ")),console.log("Default mode is 'aes-gcm'."),this._mode="aes-gcm")}},{key:"keySize",get:function(){return this._keySize},set:function(e){u.includes(e)?this._keySize=e:(console.log(e+" is not accepted."),console.log("Accepted keySize are "+u.join(", ")),console.log("Default keySize is '128'."),this._keySize=128)}}]),e}();n.default=l,n.aesModes={CBC:"aes-cbc",GCM:"aes-gcm",CTR:"aes-ctr"},n.AES=l},{"./utils.js":5}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){console.log(e),console.log(e.code)},o=["P-256","P-384","P-521"],a=["ECDH","ECDSA"],u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t.name||"ECDH",this.curve=t.curve||"P-384",this.hash=t.hash||"SHA-256",this.publicKey=null,this.privateKey=null}return r(e,[{key:"genECKeyPair",value:function(){var e=this;return crypto.subtle.generateKey({name:this.name,namedCurve:this.curve},!1,"ECDH"===this.name?["deriveKey","deriveBits"]:["sign","verify"]).then(function(t){return e.publicKey=t.publicKey,e.privateKey=t.privateKey,t}).catch(function(e){switch(e.code){case 9:console.log("WebCrypto API error :\n - During ECDH key generation: given namedCurve parameter is not accepted");break;default:console.log(e)}})}},{key:"checkRaw",value:function(e,t){return new Promise(function(n,r){t instanceof Uint8Array?e.importKeyRaw(t).then(n).catch(i):n(t)})}},{key:"deriveKeyECDH",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"aes-gcm",n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,o=arguments[3];return this.checkRaw(this,e).then(function(e){return crypto.subtle.deriveKey({name:n.name,public:e},o||n.privateKey,{name:t,length:r},!0,["decrypt","encrypt"])}).then(function(e){return crypto.subtle.exportKey("raw",e)}).then(function(e){return new Uint8Array(e)}).catch(i)}},{key:"exportKeyRaw",value:function(e){return crypto.subtle.exportKey("raw",e||this.publicKey).then(function(e){return new Uint8Array(e)}).catch(i)}},{key:"importKeyRaw",value:function(e,t,n){return crypto.subtle.importKey("raw",e,{name:n||this.name,namedCurve:t||this.curve},!0,[])}},{key:"signEC",value:function(e,t,n){return crypto.subtle.sign({name:"ECDSA",hash:{name:n||this.hash}},t||this.privateKey,e).then(function(e){return new Uint8Array(e)}).catch(i)}},{key:"verifEC",value:function(e,t,n,r){return crypto.subtle.verify({name:"ECDSA",hash:{name:r||this.hash}},e,t,n)}},{key:"curve",get:function(){return this._curve},set:function(e){o.includes(e)?this._curve=e:(console.log(e+" is not accepted."),console.log("Accepted curves are "+o.join(", ")),this._curve=e)}},{key:"name",get:function(){return this._name},set:function(e){a.includes(e)?this._name=e:(console.log(e+" is not accepted."),console.log("Accepted names are "+a.join(", ")),this._name=e)}}]),e}();n.default=u,n.EC=u},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){console.log(e)},o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modulusLength=t.modulusLength||4096,this.hash=t.hash||"SHA-256",this.name=t.name||"RSA-PSS",this.publicKey=null,this.private=null}return r(e,[{key:"genRSAKeyPair",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4096,t=this;return crypto.subtle.generateKey({name:"RSA-PSS",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"]).then(function(e){return t.publicKey=e.publicKey,t.privateKey=e.privateKey,e}).catch(i)}},{key:"verifRSA",value:function(e,t,n){return crypto.subtle.verify({name:"RSA-PSS",saltLength:16},e,t,n)}},{key:"signRSA",value:function(e,t){return crypto.subtle.sign({name:"RSA-PSS",saltLength:16},t||this.privateKey,e).then(function(e){return new Uint8Array(e)}).catch(i)}},{key:"importRSAPubKeyRaw",value:function(e,t,n){return crypto.subtle.importKey("jwk",{kty:e.kty,e:e.e,n:e.n,alg:e.alg,ext:e.ext},{name:t||"RSA-PSS",hash:{name:n||"SHA-256"}},!1,["verify"])}},{key:"exportRSAPubKeyRaw",value:function(e,t){return crypto.subtle.exportKey(t||"jwk",e||this.publicKey)}},{key:"publicKey",get:function(){return this._publicKey},set:function(e){this._publicKey=e}},{key:"privateKey",get:function(){return this._privateKey},set:function(e){this._privateKey=e}}]),e}();n.default=o,n.RSA=o},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.utils=void 0;var i=e("./EC");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var o=e("./AES");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var a=e("./RSA");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})});r(o),r(i),r(a);var u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./utils"));n.utils=u},{"./AES":1,"./EC":2,"./RSA":3,"./utils":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return new Uint8Array(t)};n.default=r,n.toArray=r,n.hash=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return window.crypto.subtle.digest({name:"SHA-256"},"string"==typeof passPhrase?r(e):e).then(function(e){return new Uint8Array(e)}).catch(function(e){return console.log(e)})},n.bufferToHexString=function(e){if(!e)return null;for(var t=[],n=0;n<e.length;++n){var r=e[n].toString(16);r.length<2&&(r="0"+r),t.push(r)}return t.join("")},n.toString=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},n.hexStringToBuffer=function(e){if(e.length%2!=0)throw new Error("Invalid hexString");for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2){var r=parseInt(e.substr(n,2),16);if(isNaN(r))throw new Error("Invalid hexString");t[n/2]=r}return t},n.deriveKey=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;return n<1e4&&console.log("The iteration number is less than 10000, increase it !"),crypto.subtle.importKey("raw","string"==typeof e?r(e):e,"PBKDF2",!1,["deriveBits","deriveKey"]).then(function(e){return crypto.subtle.deriveBits({name:"PBKDF2",salt:t||new Uint8Array([]),iterations:n,hash:"sha-256"},e,128)}).then(function(e){return new Uint8Array(e)}).catch(function(e){return console.log(e)})},n.randomString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:18,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="";if(window.crypto&&window.crypto.getRandomValues){var r=new Uint32Array(e);window.crypto.getRandomValues(r);for(var i=0;i<e;i++)n+=t[r[i]%t.length]}else console.log("Your browser can't generate secure random numbers");return n}},{}]},{},[4])(4)});